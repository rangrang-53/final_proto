# ì‹œìŠ¤í…œ ì•„í‚¤í…ì²˜ (System Architecture)
## 5060 ì¤‘ìž¥ë…„ì¸µ ê°€ì „ì œí’ˆ ì‚¬ìš©ë²• ì•ˆë‚´ Agent í”„ë¡œí† íƒ€ìž…

## ì•„í‚¤í…ì²˜ êµ¬ì„±ìš”ì†Œ

### ì „ì²´ ì‹œìŠ¤í…œ êµ¬ì¡°
```mermaid
graph TB
    subgraph "ì‚¬ìš©ìž ê³„ì¸µ"
        U[ðŸ‘¥ 5060 ì¤‘ìž¥ë…„ì¸µ ì‚¬ìš©ìž]
        D[ðŸ“± ë””ë°”ì´ìŠ¤: ìŠ¤ë§ˆíŠ¸í°/PC]
    end
    
    subgraph "í”„ë ˆì  í…Œì´ì…˜ ê³„ì¸µ"
        ST[ðŸ–¥ï¸ Streamlit Frontend]
        UI[ðŸŽ¨ ì¤‘ìž¥ë…„ì¸µ ì¹œí™”ì  UI]
    end
    
    subgraph "ì• í”Œë¦¬ì¼€ì´ì…˜ ê³„ì¸µ"
        API[âš¡ FastAPI Backend]
        subgraph "ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§"
            IMG[ðŸ–¼ï¸ ì´ë¯¸ì§€ ì²˜ë¦¬ ëª¨ë“ˆ]
            SES[ðŸ”„ ì„¸ì…˜ ê´€ë¦¬ ëª¨ë“ˆ]
            VAL[âœ… ê²€ì¦ ëª¨ë“ˆ]
        end
    end
    
    subgraph "AI ì—ì´ì „íŠ¸ ê³„ì¸µ"
        LG[ðŸ¤– LangGraph Agent]
        GM[ðŸ§  Gemini-2.5-flash-preview-05-20]
        MEM[ðŸ’¾ ë¡œì»¬ ë©”ëª¨ë¦¬]
        LS[ðŸ“Š LangSmith ëª¨ë‹ˆí„°ë§]
    end
    
    subgraph "ì™¸ë¶€ ì„œë¹„ìŠ¤ ê³„ì¸µ"
        subgraph "MCP Tools"
            NS[ðŸ” Naver Search MCP]
            ES[ðŸŒ Exa Search MCP]
        end
        GV[ðŸ‘ï¸ Gemini Vision API]
    end
    
    U --> D
    D --> ST
    ST --> UI
    UI --> API
    API --> IMG
    API --> SES
    API --> VAL
    API --> LG
    LG --> GM
    LG --> MEM
    LG --> LS
    LG --> NS
    LG --> ES
    GM --> GV
```

## ê³„ì¸µ êµ¬ì¡°

### 4ê³„ì¸µ ì•„í‚¤í…ì²˜
```mermaid
graph TD
    subgraph "Layer 1: Presentation Layer"
        A1[Streamlit Web Interface]
        A2[ë°˜ì‘í˜• UI Components]
        A3[ì¤‘ìž¥ë…„ì¸µ ì¹œí™”ì  UX]
    end
    
    subgraph "Layer 2: Application Layer"
        B1[FastAPI REST API]
        B2[ì´ë¯¸ì§€ ì—…ë¡œë“œ í•¸ë“¤ëŸ¬]
        B3[ì„¸ì…˜ ê´€ë¦¬ ì„œë¹„ìŠ¤]
        B4[ì—ëŸ¬ í•¸ë“¤ë§]
    end
    
    subgraph "Layer 3: Business Logic Layer"
        C1[AI Agent ì˜¤ì¼€ìŠ¤íŠ¸ë ˆì´ì…˜]
        C2[ì œí’ˆ ì¸ì‹ ë¡œì§]
        C3[ì‚¬ìš©ë²• ìƒì„± ë¡œì§]
        C4[ëŒ€í™” ì²˜ë¦¬ ë¡œì§]
    end
    
    subgraph "Layer 4: External Services Layer"
        D1[Gemini Vision API]
        D2[Naver Search MCP]
        D3[Exa Search MCP]
        D4[LangSmith Monitoring]
    end
    
    A1 --> B1
    A2 --> B2
    A3 --> B3
    B1 --> C1
    B2 --> C2
    B3 --> C3
    B4 --> C4
    C1 --> D1
    C2 --> D2
    C3 --> D3
    C4 --> D4
```

## ëª¨ë“ˆí™” ë° ì»´í¬ë„ŒíŠ¸

### í”„ë¡ íŠ¸ì—”ë“œ ì»´í¬ë„ŒíŠ¸ êµ¬ì¡°
```mermaid
graph LR
    subgraph "Streamlit App"
        M[ðŸ“± Main App]
        subgraph "UI Components"
            UC[ðŸ“¤ Upload Component]
            CC[ðŸ“¸ Camera Component]
            CH[ðŸ’¬ Chat Component]
            DP[ðŸ–¼ï¸ Display Component]
        end
        subgraph "State Management"
            SS[ðŸ—‚ï¸ Session State]
            CS[ðŸ”„ Cache State]
        end
    end
    
    M --> UC
    M --> CC
    M --> CH
    M --> DP
    M --> SS
    M --> CS
```

### ë°±ì—”ë“œ ëª¨ë“ˆ êµ¬ì¡°
```mermaid
graph TB
    subgraph "FastAPI Application"
        R[ðŸ›£ï¸ Router]
        subgraph "Services"
            IS[ðŸ–¼ï¸ Image Service]
            AS[ðŸ¤– Agent Service]
            SS[ðŸ”„ Session Service]
        end
        subgraph "Models"
            RM[ðŸ“ Request Models]
            RSM[ðŸ“¤ Response Models]
        end
        subgraph "Utils"
            IU[ðŸ”§ Image Utils]
            VU[âœ… Validation Utils]
            EU[âŒ Error Utils]
        end
    end
    
    R --> IS
    R --> AS
    R --> SS
    IS --> RM
    AS --> RSM
    SS --> IU
    IS --> VU
    AS --> EU
```

### AI Agent ì»´í¬ë„ŒíŠ¸ êµ¬ì¡°
```mermaid
graph TD
    subgraph "LangGraph Agent"
        RA[âš›ï¸ React Agent]
        subgraph "Tools"
            VT[ðŸ‘ï¸ Vision Tool]
            NT[ðŸ” Naver Tool]
            ET[ðŸŒ Exa Tool]
        end
        subgraph "Memory"
            LM[ðŸ’¾ Local Memory]
            CH[ðŸ“š Chat History]
        end
        subgraph "Prompts"
            PP[ðŸŽ¯ Product Prompt]
            GP[ðŸ“– Guide Prompt]
            SP[ðŸ›¡ï¸ Safety Prompt]
        end
    end
    
    RA --> VT
    RA --> NT
    RA --> ET
    RA --> LM
    RA --> CH
    VT --> PP
    NT --> GP
    ET --> SP
```

## ë°ì´í„° íë¦„

### ì „ì²´ ë°ì´í„° í”Œë¡œìš°
```mermaid
sequenceDiagram
    participant U as ðŸ‘¥ ì‚¬ìš©ìž
    participant ST as ðŸ–¥ï¸ Streamlit
    participant API as âš¡ FastAPI
    participant AG as ðŸ¤– Agent
    participant GM as ðŸ§  Gemini
    participant MCP as ðŸ” MCP Tools
    
    U->>ST: 1. ì´ë¯¸ì§€ ì—…ë¡œë“œ/ì´¬ì˜
    ST->>API: 2. POST /api/analyze-product
    API->>AG: 3. ì´ë¯¸ì§€ ë¶„ì„ ìš”ì²­
    AG->>GM: 4. Gemini Vision í˜¸ì¶œ
    GM-->>AG: 5. ì œí’ˆ ì¸ì‹ ê²°ê³¼
    AG->>MCP: 6. ì œí’ˆ ì •ë³´ ê²€ìƒ‰
    MCP-->>AG: 7. ì‚¬ìš©ë²• ì •ë³´ ë°˜í™˜
    AG-->>API: 8. ë¶„ì„ ê²°ê³¼ + ê¸°ë³¸ ê°€ì´ë“œ
    API-->>ST: 9. ì œí’ˆ ì •ë³´ ì‘ë‹µ
    ST-->>U: 10. ì œí’ˆ ì •ë³´ + ê¸°ë³¸ ì‚¬ìš©ë²• í‘œì‹œ
    
    U->>ST: 11. ì¶”ê°€ ì§ˆë¬¸ ìž…ë ¥
    ST->>API: 12. POST /api/chat
    API->>AG: 13. ëŒ€í™” ì²˜ë¦¬ ìš”ì²­
    AG->>GM: 14. ë§žì¶¤í˜• ì‘ë‹µ ìƒì„±
    GM-->>AG: 15. ìƒì„¸ ê°€ì´ë“œ ìƒì„±
    AG-->>API: 16. ëŒ€í™” ì‘ë‹µ
    API-->>ST: 17. ì±„íŒ… ì‘ë‹µ
    ST-->>U: 18. ë§žì¶¤í˜• ì‚¬ìš©ë²• ê°€ì´ë“œ í‘œì‹œ
```

### ì„¸ì…˜ ê¸°ë°˜ ë°ì´í„° ê´€ë¦¬
```mermaid
graph LR
    subgraph "Session Data Flow"
        SC[ðŸ†” Session Create]
        SI[ðŸ–¼ï¸ Session Image]
        SP[ðŸ“‹ Session Product]
        SH[ðŸ’¬ Session History]
        SD[ðŸ—‘ï¸ Session Delete]
    end
    
    SC --> SI
    SI --> SP
    SP --> SH
    SH --> SD
    
    subgraph "Memory Management"
        TM[â° Temporary Memory]
        LM[ðŸ’¾ Local Memory]
        CM[ðŸ—‚ï¸ Cache Memory]
    end
    
    SI --> TM
    SP --> LM
    SH --> CM
```

## API ë° ì¸í„°íŽ˜ì´ìŠ¤

### REST API ì—”ë“œí¬ì¸íŠ¸
```mermaid
graph TB
    subgraph "API Gateway"
        GW[ðŸšª FastAPI Gateway]
    end
    
    subgraph "Product Analysis API"
        PA[POST /api/analyze-product]
        PAR[ðŸ“¤ Response: ì œí’ˆì •ë³´]
    end
    
    subgraph "Chat API"
        CA[POST /api/chat]
        CAR[ðŸ“¤ Response: Agentì‘ë‹µ]
    end
    
    subgraph "Session Management API"
        SCA[POST /api/session/create]
        SGA[GET /api/session/{id}]
        SDA[DELETE /api/session/{id}]
    end
    
    subgraph "Health Check API"
        HC[GET /api/health]
        HCR[ðŸ“¤ Response: ìƒíƒœì •ë³´]
    end
    
    GW --> PA
    GW --> CA
    GW --> SCA
    GW --> SGA
    GW --> SDA
    GW --> HC
    PA --> PAR
    CA --> CAR
    HC --> HCR
```

### ì¸í„°íŽ˜ì´ìŠ¤ ëª…ì„¸
```mermaid
classDiagram
    class ImageUploadRequest {
        +file: UploadFile
        +session_id: str
        +timestamp: datetime
    }
    
    class ProductAnalysisResponse {
        +brand: str
        +model: str
        +category: str
        +confidence: float
        +basic_guide: str
    }
    
    class ChatRequest {
        +message: str
        +session_id: str
        +product_info: dict
        +context: str
    }
    
    class ChatResponse {
        +response: str
        +guide_steps: list
        +safety_notes: list
        +related_questions: list
    }
    
    ImageUploadRequest --> ProductAnalysisResponse
    ChatRequest --> ChatResponse
```

## ì‹œìŠ¤í…œ ì™¸ë¶€ í™˜ê²½ê³¼ì˜ ê´€ê³„

### ì™¸ë¶€ ì„œë¹„ìŠ¤ ì˜ì¡´ì„±
```mermaid
graph TB
    subgraph "Internal System"
        IS[ðŸ  ê°€ì „ì œí’ˆ ì‚¬ìš©ë²• ì•ˆë‚´ Agent]
    end
    
    subgraph "Google Services"
        GV[ðŸ‘ï¸ Gemini Vision API]
        GL[ðŸ§  Gemini LLM API]
        GC[â˜ï¸ Google Cloud Platform]
    end
    
    subgraph "MCP Services"
        NS[ðŸ” Naver Search API]
        ES[ðŸŒ Exa Search API]
    end
    
    subgraph "Monitoring Services"
        LS[ðŸ“Š LangSmith Platform]
        LG[ðŸ“ˆ Logging Service]
    end
    
    subgraph "User Environment"
        WB[ðŸŒ Web Browser]
        MB[ðŸ“± Mobile Browser]
        CAM[ðŸ“¸ Camera Device]
    end
    
    IS --> GV
    IS --> GL
    IS --> GC
    IS --> NS
    IS --> ES
    IS --> LS
    IS --> LG
    WB --> IS
    MB --> IS
    CAM --> IS
```

### ë„¤íŠ¸ì›Œí¬ í†µì‹  êµ¬ì¡°
```mermaid
graph LR
    subgraph "Client Side"
        CB[ðŸŒ Client Browser]
        CD[ðŸ“± Client Device]
    end
    
    subgraph "Load Balancer"
        LB[âš–ï¸ Load Balancer]
    end
    
    subgraph "Application Server"
        AS[ðŸ–¥ï¸ App Server]
        subgraph "Internal Services"
            ST[ðŸ“± Streamlit:8501]
            FA[âš¡ FastAPI:8000]
        end
    end
    
    subgraph "External APIs"
        HTTPS[ðŸ”’ HTTPS/443]
        subgraph "Third Party"
            GA[ðŸ§  Gemini API]
            NA[ðŸ” Naver API]
            EA[ðŸŒ Exa API]
        end
    end
    
    CB --> LB
    CD --> LB
    LB --> AS
    AS --> ST
    AS --> FA
    FA --> HTTPS
    HTTPS --> GA
    HTTPS --> NA
    HTTPS --> EA
```

### ë³´ì•ˆ ë° ë°ì´í„° ë³´í˜¸
```mermaid
graph TB
    subgraph "Security Layers"
        subgraph "Transport Security"
            TLS[ðŸ”’ TLS/HTTPS]
            CORS[ðŸŒ CORS Policy]
        end
        
        subgraph "Application Security"
            FS[ðŸ“ File Size Limit]
            FT[ðŸ“„ File Type Validation]
            RT[â±ï¸ Rate Limiting]
        end
        
        subgraph "Data Protection"
            NP[ðŸš« No Personal Data]
            TF[ðŸ—‘ï¸ Temporary Files]
            SM[ðŸ’¾ Session Memory Only]
        end
    end
    
    subgraph "Privacy Compliance"
        AN[ðŸ‘¤ Anonymous Usage]
        NL[ðŸ“Š No Logging Personal Data]
        AD[ðŸ”„ Auto Data Deletion]
    end
    
    TLS --> FS
    CORS --> FT
    FS --> RT
    FT --> NP
    RT --> TF
    NP --> SM
    TF --> AN
    SM --> NL
    AN --> AD
```
